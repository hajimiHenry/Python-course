# 函数和模块 📦

---

## 🎯 本节学习目标

学完本节，你将掌握：
- ✅ 什么是函数，为什么要使用函数
- ✅ 如何定义和调用函数
- ✅ 函数参数的各种用法
- ✅ 什么是模块，如何用模块管理函数
- ✅ Python 标准库中的常用函数

---

## 📖 引入：一个重复代码的问题

### 从一道数学题说起

先来看一道数学题：

> **问题**：方程 $x_{1} + x_{2} + x_{3} + x_{4} = 8$ 有多少组**正整数解**？

💡 **思路转化**：
- 这就像把 **8 个苹果** 分给 **4 个人**，每人至少 1 个
- 等同于在 8 个苹果之间的 **7 个空隙** 中，插入 **3 个隔板**
- 答案是组合数：$C_{7}^{3} = 35$

**组合数公式**：

$$
C_m^n = \frac {m!} {n!(m-n)!}
$$

> 📝 **小贴士**：$m!$ 读作「m 的阶乘」，意思是 $1 \times 2 \times 3 \times ... \times m$

---

### 💻 第一版代码：直接计算

让我们用 Python 来计算这个组合数：

```python
"""
输入m和n，计算组合数C(m,n)的值

Version: 1.0
Author: 骆昊
"""

m = int(input('m = '))
n = int(input('n = '))

# 计算m的阶乘
fm = 1
for num in range(1, m + 1):
    fm *= num

# 计算n的阶乘
fn = 1
for num in range(1, n + 1):
    fn *= num

# 计算m-n的阶乘
fk = 1
for num in range(1, m - n + 1):
    fk *= num

# 计算C(M,N)的值
print(fm // fn // fk)
```

**运行结果**：
```
m = 7
n = 3
35
```

---

### ❓ 发现问题了吗？

仔细看上面的代码，你会发现：

| 第1段 | 第2段 | 第3段 |
|:---:|:---:|:---:|
| 计算 m! | 计算 n! | 计算 (m-n)! |
| `for num in range(1, m + 1)` | `for num in range(1, n + 1)` | `for num in range(1, m - n + 1)` |

**三段代码几乎一模一样！** 只是计算的上限不同。

> 🎯 **编程大师 Martin Fowler 说过**：
> 
> *"代码有很多种坏味道，**重复**是最坏的一种！"*

**解决方案**：把「求阶乘」这个功能封装成一个 **函数（Function）**

---

## 第一章：定义函数

### 1.1 函数是什么？

你在数学课上见过这样的式子：

| 数学表示 | Python类比 |
|:---:|:---:|
| $y = f(x)$ | `y = f(x)` |
| $f$ 是函数名 | `f` 是函数名 |
| $x$ 是自变量 | `x` 是**参数** |
| $y$ 是因变量 | `y` 是**返回值** |

> 💡 **简单理解**：函数就像一个「加工机器」——
> - 你把**原料（参数）**放进去
> - 机器**处理一番（函数体）**
> - 然后给你**产品（返回值）**

---

### 1.2 如何定义函数？

Python 使用 `def` 关键字定义函数：

<img src="res/day14/function_definition.png" style="zoom:45%;">

**语法结构**：
```
def 函数名(参数1, 参数2, ...):
    函数体（要执行的代码）
    return 返回值
```

**关键点**：
| 元素 | 说明 |
|:---|:---|
| `def` | 定义函数的关键字（define 的缩写） |
| 函数名 | 遵循变量命名规则（小写字母+下划线） |
| 圆括号 `()` | 必须有，里面放参数 |
| 冒号 `:` | 表示函数体开始 |
| 缩进代码块 | 函数要执行的代码 |
| `return` | 返回结果（可选，没有则返回 `None`） |

---

### 1.3 实战：用函数重构代码

现在，让我们用函数来改写之前的代码：

```python
"""
输入m和n，计算组合数C(m,n)的值

Version: 1.1
Author: 骆昊
"""

# ========== 定义函数 ==========
def fac(num):
    """
    计算 num 的阶乘
    参数：num - 一个非负整数
    返回：num 的阶乘值
    """
    result = 1
    for n in range(2, num + 1):
        result *= n
    return result


# ========== 主程序 ==========
m = int(input('m = '))
n = int(input('n = '))

# 一行代码搞定！不再重复写三遍阶乘计算
print(fac(m) // fac(n) // fac(m - n))
```

**对比一下**：

| 对比项 | 重构前 | 重构后 |
|:---|:---|:---|
| 代码行数 | 约20行 | 约15行 |
| 重复代码 | 3段几乎相同的循环 | 无重复 |
| 可读性 | ⭐⭐ | ⭐⭐⭐⭐ |
| 可复用性 | ❌ 不能复用 | ✅ 随时可以调用 `fac()` |

---

### 1.4 更优解：使用标准库

其实，Python 已经帮我们写好了阶乘函数！

```python
"""
输入m和n，计算组合数C(m,n)的值

Version: 1.2
Author: 骆昊
"""
from math import factorial  # 导入math模块中的factorial函数

m = int(input('m = '))
n = int(input('n = '))
print(factorial(m) // factorial(n) // factorial(m - n))
```

> 🎯 **编程原则**：不要「重复发明轮子」！
> 
> 如果标准库已经有现成的函数，直接用就好。

---

### 1.5 小技巧：给函数起别名

`factorial` 这个名字太长了？可以用 `as` 关键字起个短名：

```python
from math import factorial as f  # 把 factorial 简称为 f

m = int(input('m = '))
n = int(input('n = '))
print(f(m) // f(n) // f(m - n))  # 用 f 代替 factorial
```

---

## 第二章：函数的参数

### 2.1 位置参数 vs 关键字参数

先定义一个判断三角形的函数：

```python
def can_form_triangle(a, b, c):
    """判断三条边能否构成三角形"""
    return a + b > c and b + c > a and a + c > b
```

**两种调用方式**：

| 调用方式 | 示例 | 说明 |
|:---|:---|:---|
| **位置参数** | `can_form_triangle(1, 2, 3)` | 按顺序传入，1→a, 2→b, 3→c |
| **关键字参数** | `can_form_triangle(b=2, c=3, a=1)` | 指定参数名，顺序随意 |

```python
# 位置参数（按顺序）
print(can_form_triangle(1, 2, 3))  # False
print(can_form_triangle(4, 5, 6))  # True

# 关键字参数（指定名字）
print(can_form_triangle(b=2, c=3, a=1))  # False
print(can_form_triangle(c=6, b=4, a=5))  # True
```

---

### 2.2 强制位置参数与命名关键字参数

Python 允许你**强制**调用者使用特定的传参方式：

| 符号 | 作用 | 举例 |
|:---:|:---|:---|
| `/` | 前面的参数**只能用位置传递** | `def foo(a, b, /)` |
| `*` | 后面的参数**只能用关键字传递** | `def bar(*, x, y)` |

**示例1：强制位置参数**

```python
def can_form_triangle(a, b, c, /):
    """三角形判断（参数只能按位置传入）"""
    return a + b > c and b + c > a and a + c > b

# ✅ 正确：按位置传参
print(can_form_triangle(3, 4, 5))

# ❌ 错误：不允许用参数名
# print(can_form_triangle(a=3, b=4, c=5))
# TypeError: got some positional-only arguments passed as keyword arguments
```

> ⚠️ **注意**：这是 Python 3.8 的新特性

**示例2：命名关键字参数**

```python
def can_form_triangle(*, a, b, c):
    """三角形判断（参数必须用关键字传入）"""
    return a + b > c and b + c > a and a + c > b

# ✅ 正确：用参数名传参
print(can_form_triangle(a=3, b=4, c=5))

# ❌ 错误：不能按位置传
# print(can_form_triangle(3, 4, 5))
# TypeError: takes 0 positional arguments but 3 were given
```

---

### 2.3 参数的默认值

可以给参数设置默认值，调用时可以省略该参数：

```python
from random import randrange

def roll_dice(n=2):
    """
    摇骰子
    参数 n: 骰子数量（默认2个）
    返回: 总点数
    """
    total = 0
    for _ in range(n):
        total += randrange(1, 7)
    return total

# 不传参数 → 使用默认值 n=2
print(roll_dice())    # 摇2个骰子

# 传入参数 → 覆盖默认值
print(roll_dice(3))   # 摇3个骰子
```

**再看一个例子**：

```python
def add(a=0, b=0, c=0):
    """三个数相加"""
    return a + b + c

print(add())           # 0     → a=0, b=0, c=0
print(add(1))          # 1     → a=1, b=0, c=0
print(add(1, 2))       # 3     → a=1, b=2, c=0
print(add(1, 2, 3))    # 6     → a=1, b=2, c=3
```

> ⚠️ **重要规则**：
> 
> **带默认值的参数必须放在不带默认值的参数后面！**
> 
> ```python
> # ❌ 错误写法
> def foo(a=1, b):  # SyntaxError: non-default argument follows default argument
>     pass
> 
> # ✅ 正确写法
> def foo(b, a=1):
>     pass
> ```

---

### 2.4 可变参数

有时候，我们不确定调用者会传入多少个参数，这时可以使用**可变参数**。

#### `*args`：接收任意多个位置参数

```python
def add(*args):
    """计算任意多个数的和"""
    total = 0
    for val in args:
        if type(val) in (int, float):
            total += val
    return total

# 传入0个、1个或多个参数都可以
print(add())                        # 0
print(add(1))                       # 1
print(add(1, 2, 3))                 # 6
print(add(1, 2, 'hello', 3.45, 6))  # 12.45（忽略字符串）
```

> 💡 **原理**：`*args` 会把所有传入的位置参数打包成一个**元组（tuple）**

#### `**kwargs`：接收任意多个关键字参数

```python
def show_info(*args, **kwargs):
    """展示所有传入的参数"""
    print("位置参数:", args)      # 元组
    print("关键字参数:", kwargs)  # 字典

show_info(3, 2.1, True, name='骆昊', age=43, gpa=4.95)
```

**输出**：
```
位置参数: (3, 2.1, True)
关键字参数: {'name': '骆昊', 'age': 43, 'gpa': 4.95}
```

> 💡 **原理**：`**kwargs` 会把所有传入的关键字参数打包成一个**字典（dict）**

---

## 第三章：用模块管理函数

### 3.1 问题：函数命名冲突

想象一下这个场景：

```python
def foo():
    print('hello, world!')

def foo():
    print('goodbye, world!')

foo()  # 猜猜输出什么？
```

答案是 `goodbye, world!`——后定义的函数覆盖了前面的。

> ❓ **问题**：在大型项目中，不同人可能定义同名函数，怎么办？

---

### 3.2 解决方案：模块（Module）

在 Python 中，**每个 `.py` 文件就是一个模块**。

通过把函数放在不同模块中，我们可以避免命名冲突：

**文件结构**：
```
项目目录/
├── module1.py
├── module2.py
└── test.py
```

**module1.py**：
```python
def foo():
    print('hello, world!')
```

**module2.py**：
```python
def foo():
    print('goodbye, world!')
```

**test.py**（方式一：用完全限定名）：
```python
import module1
import module2

module1.foo()  # hello, world!
module2.foo()  # goodbye, world!
```

---

### 3.3 导入模块的几种方式

| 导入方式 | 语法示例 | 调用方式 |
|:---|:---|:---|
| 导入整个模块 | `import module1` | `module1.foo()` |
| 导入模块并起别名 | `import module1 as m1` | `m1.foo()` |
| 从模块导入函数 | `from module1 import foo` | `foo()` |
| 导入函数并起别名 | `from module1 import foo as f1` | `f1()` |

**示例**：

```python
# 方式1：导入模块并起别名
import module1 as m1
import module2 as m2

m1.foo()  # hello, world!
m2.foo()  # goodbye, world!
```

```python
# 方式2：直接导入函数
from module1 import foo

foo()  # hello, world!

from module2 import foo  # ⚠️ 这会覆盖上面导入的foo！

foo()  # goodbye, world!
```

```python
# 方式3：导入函数并起别名（推荐！）
from module1 import foo as f1
from module2 import foo as f2

f1()  # hello, world!
f2()  # goodbye, world!
```

> 🎯 **最佳实践**：
> 
> 当从多个模块导入同名函数时，**用 `as` 起不同的别名**

---

## 第四章：标准库中的模块和函数

### 4.1 常用模块速览

Python 标准库提供了大量开箱即用的模块：

| 模块 | 功能 | 常用函数 |
|:---|:---|:---|
| `math` | 数学运算 | `factorial()`, `sqrt()`, `sin()`, `cos()` |
| `random` | 随机数 | `randint()`, `random()`, `choice()` |
| `time` | 时间操作 | `time()`, `sleep()` |
| `os` | 操作系统交互 | `path`, `listdir()` |

---

### 4.2 内置函数（无需导入）

有些函数是 Python **自带**的，不需要 `import` 就能直接使用：

| 函数 | 说明 | 示例 |
|:---|:---|:---|
| `abs()` | 绝对值 | `abs(-1.3)` → `1.3` |
| `bin()` | 转二进制 | `bin(123)` → `'0b1111011'` |
| `chr()` | Unicode→字符 | `chr(8364)` → `'€'` |
| `ord()` | 字符→Unicode | `ord('€')` → `8364` |
| `hex()` | 转十六进制 | `hex(123)` → `'0x7b'` |
| `oct()` | 转八进制 | `oct(123)` → `'0o173'` |
| `input()` | 读取用户输入 | `name = input('请输入姓名:')` |
| `len()` | 获取长度 | `len('hello')` → `5` |
| `max()` | 最大值 | `max(12, 95, 37)` → `95` |
| `min()` | 最小值 | `min(12, 95, 37)` → `12` |
| `sum()` | 求和 | `sum([1,2,3])` → `6` |
| `pow()` | 幂运算 | `pow(2, 3)` → `8` |
| `round()` | 四舍五入 | `round(1.23456, 2)` → `1.23` |
| `type()` | 查看类型 | `type(10)` → `<class 'int'>` |
| `print()` | 打印输出 | `print('Hello!')` |
| `range()` | 生成范围 | `range(5)` → `0,1,2,3,4` |
| `open()` | 打开文件 | `f = open('data.txt')` |

---

## 📝 总结

### 核心概念回顾

```
┌─────────────────────────────────────────────────────────┐
│                         函数                             │
│  ┌───────────────────────────────────────────────────┐  │
│  │  def 函数名(参数):                                  │  │
│  │      函数体                                        │  │
│  │      return 返回值                                 │  │
│  └───────────────────────────────────────────────────┘  │
│                                                          │
│  作用：封装可重用的代码，消除重复                          │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                         模块                             │
│  ┌───────────────────────────────────────────────────┐  │
│  │  一个 .py 文件 = 一个模块                           │  │
│  │  import 模块名                                     │  │
│  │  from 模块名 import 函数名                          │  │
│  └───────────────────────────────────────────────────┘  │
│                                                          │
│  作用：组织代码，避免命名冲突                              │
└─────────────────────────────────────────────────────────┘
```

### 本节要点

1. **函数的本质**：把功能独立、会重复使用的代码封装起来
2. **定义函数**：使用 `def` 关键字
3. **参数类型**：
   - 位置参数 vs 关键字参数
   - 默认参数
   - 可变参数（`*args`, `**kwargs`）
4. **模块管理**：用模块解决命名冲突
5. **善用标准库**：不要重复造轮子！

---

## 🚀 下一步建议

1. 尝试自己定义几个函数，练习参数的使用
2. 探索 `math`、`random` 模块中的其他函数
3. 把之前写过的重复代码用函数重构一下

---

*Happy Coding! 💻*
